(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const V=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),M=(e,{currentUserId:t,onPreviewPicture:o,onLikeIcon:c,onDeleteClick:r})=>{const n=V(),a=n.querySelector(".card__like-button"),h=n.querySelector(".card__like-count"),s=n.querySelector(".card__control-button_type_delete"),_=n.querySelector(".card__image");return _.src=e.link,_.alt=e.name,n.querySelector(".card__title").textContent=e.name,h.textContent=e.likes.length,e.likes.some(R=>R._id===t)&&a.classList.add("card__like-button_is-active"),e.owner._id!==t?s.remove():s.addEventListener("click",()=>r(n,e._id)),a.addEventListener("click",()=>c(a,e._id,h)),_.addEventListener("click",()=>o({name:e.name,link:e.link})),n},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},K=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})};function P(e,t,o,c){const r=e.querySelector(`#${t.id}-error`);t.classList.add(c.inputErrorClass),r.textContent=o,r.classList.add(c.errorClass)}function Z(e,t,o){const c=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),c.textContent="",c.classList.remove(o.errorClass)}function G(e,t,o){if(t.dataset.errorMessage&&!/^[A-Za-zА-Яа-яЁё\s-]+$/.test(t.value)){P(e,t,t.dataset.errorMessage,o);return}if(!t.validity.valid){P(e,t,t.validationMessage,o);return}Z(e,t,o)}function Q(e){return e.some(t=>!t.validity.valid)}function X(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function Y(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function T(e,t,o){Q(e)?X(t,o):Y(t,o)}function ee(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);T(o,c,t),o.forEach(r=>{r.addEventListener("input",()=>{G(e,r,t),T(o,c,t)})})}function te(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ee(o,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"c3dcd9c1-36e2-4dd8-80ed-f05b003e0ec4","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(p),A=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(p),re=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(p),ne=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(p),ce=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(p),se=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(p),le=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(p),D=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),S=q.querySelector(".popup__form"),N=S.querySelector(".popup__input_type_name"),O=S.querySelector(".popup__input_type_description"),ae=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit-avatar"),L=E.querySelector(".popup__form"),ie=L.querySelector(".popup__input"),x=document.querySelector(".popup_type_new-card"),d=x.querySelector(".popup__form"),ue=d.querySelector(".popup__input_type_card-name"),pe=d.querySelector(".popup__input_type_url"),de=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_image"),U=I.querySelector(".popup__image"),me=I.querySelector(".popup__caption"),B=document.querySelector(".popup_type_remove-card"),w=B.querySelector(".popup__form"),y=document.querySelector(".popup_type_info"),_e=y.querySelector(".popup__title"),f=y.querySelector(".popup__info"),fe=y.querySelector(".popup__text"),$=y.querySelector(".popup__list"),ye=document.getElementById("popup-info-definition-template"),he=document.getElementById("popup-info-user-preview-template"),ve=document.querySelector(".header__logo");let b=null,W=null,H=null;const i=(e,t,o,c)=>{e.textContent=t?c:o},j=({name:e,link:t})=>{U.src=t,U.alt=e,me.textContent=e,m(I)},Se=e=>{e.preventDefault();const t=S.querySelector(".popup__button");i(t,!0,"Сохранить","Сохранение..."),re({name:N.value,about:O.value}).then(o=>{g.textContent=o.name,C.textContent=o.about,u(q)}).catch(console.log).finally(()=>{i(t,!1,"Сохранить","Сохранение...")})},Le=e=>{e.preventDefault();const t=L.querySelector(".popup__button");i(t,!0,"Сохранить","Сохранение..."),ne(ie.value).then(o=>{k.style.backgroundImage=`url(${o.avatar})`,u(E)}).catch(console.log).finally(()=>{i(t,!1,"Сохранить","Сохранение...")})},be=e=>{e.preventDefault();const t=d.querySelector(".popup__button");i(t,!0,"Создать","Создание...");const o=ue.value,c=pe.value;ce({name:o,link:c}).then(r=>{const n=M(r,{currentUserId:b,onPreviewPicture:j,onLikeIcon:J,onDeleteClick:z});D.prepend(n),u(x),d.reset()}).catch(console.log).finally(()=>{i(t,!1,"Создать","Создание...")})},z=(e,t)=>{W=e,H=t,m(B)},J=(e,t,o)=>{const c=e.classList.contains("card__like-button_is-active");le(t,c).then(r=>{e.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>console.log(r))};w.addEventListener("submit",e=>{e.preventDefault();const t=w.querySelector(".popup__button");i(t,!0,"Да","Удаление..."),se(H).then(()=>{W.remove(),u(B)}).catch(console.log).finally(()=>{i(t,!1,"Да","Удаление...")})});const v=(e,t)=>{const o=ye.content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},qe=e=>{const t=he.content.cloneNode(!0);return t.querySelector(".popup__list-item").textContent=e,t},ge=()=>{f.innerHTML="",$.innerHTML="",_e.textContent="Статистика карточек",A().then(e=>{const o=new Set(e.map(s=>s.owner.name)).size,c=e.reduce((s,_)=>s+_.likes.length,0),r=Math.max(...e.map(s=>s.likes.length)),n=e.find(s=>s.likes.length===r),a=n?n.owner.name:"—",h=e.filter(s=>s.likes.length===r).map(s=>s.name);f.append(v("Всего пользователей:",o)),f.append(v("Всего лайков:",c)),f.append(v("Максимально лайков от одного:",r)),f.append(v("Чемпион лайков:",a)),fe.textContent="Популярные карточки:",h.forEach(s=>{$.append(qe(s))}),m(y)}).catch(console.log)};ve.addEventListener("click",ge);S.addEventListener("submit",Se);d.addEventListener("submit",be);L.addEventListener("submit",Le);ae.addEventListener("click",()=>{N.value=g.textContent,O.value=C.textContent,m(q)});k.addEventListener("click",()=>{L.reset(),m(E)});de.addEventListener("click",()=>{d.reset(),m(x)});document.querySelectorAll(".popup").forEach(e=>{K(e)});te({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});Promise.all([oe(),A()]).then(([e,t])=>{b=e._id,g.textContent=e.name,C.textContent=e.about,k.style.backgroundImage=`url(${e.avatar})`,t.reverse().forEach(o=>D.append(M(o,{currentUserId:b,onPreviewPicture:j,onLikeIcon:J,onDeleteClick:z})))}).catch(console.log);
